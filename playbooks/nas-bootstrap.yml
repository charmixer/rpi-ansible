# export ANSIBLE_INVENTORY=$(readlink -f hosts)
# ansible-playbook playbooks/raspi-bootstrap.yml

---
- hosts: cluster_nas
  gather_facts: yes

  vars:
    # file permission
    user: charmixer
    group: charmixer

    timezone: "Europe/Copenhagen"
    locale: "en_DK.UTF-8"
    apt_packages:
    - git
    - curl

  tasks:

    #- debug: var=ansible_default_ipv4.address
    #- debug: msg={{ net_ip }}

    - name: Setup static network interface
      become: yes
      ansible.builtin.template:
        src: ../templates/netplan.j2
        dest: /etc/netplan/01-netcfg.yaml
        owner: "{{ user }}"
        group: "{{ group }}"
        mode: '0644'
      when: ansible_facts['distribution'] == "Ubuntu"

    - name: Apply netplan
      command: sudo netplan apply
      async: 45
      poll: 0

    - import_tasks: ../tasks/apt.yml
      tags: [setup, apt]
      when: ansible_facts['distribution'] == "Ubuntu"
