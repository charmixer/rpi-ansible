# export ANSIBLE_INVENTORY=$(readlink -f hosts)
# ansible-playbook playbooks/raspi-bootstrap.yml

---
- hosts: db
  gather_facts: yes

  vars:
    # file permission
    user: charmixer
    group: charmixer

    timezone: "Europe/Copenhagen"
    locale: "en_DK.UTF-8"
    apt_packages:
    - git
    - curl

  tasks:

    #- debug: var=ansible_default_ipv4.address
    #- debug: msg={{ net_ip }}

    - name: Mount drive
      include_tasks:  ../tasks/mount.yml
      vars:
        mount_path: "/mnt/storage"
        mount_guid: "f143b6c9-2ffa-4baa-8dec-eab056948dcc"
        mount_state: "mounted"
        mount_fs: "ext4"

    - name: Setup static network interface
      become: yes
      ansible.builtin.template:
        src: ../templates/netplan.j2
        dest: /etc/netplan/01-netcfg.yaml
        owner: "{{ user }}"
        group: "{{ group }}"
        mode: '0644'
      when: ansible_facts['distribution'] == "Ubuntu"

    - import_tasks: ../tasks/apt.yml
      tags: [setup, apt]
      when: ansible_facts['distribution'] == "Ubuntu"

    - name: Install Docker (Ubuntu)
      include_tasks:  ../tasks/docker-ubuntu.yml
      when: ansible_facts['distribution'] == "Ubuntu"
